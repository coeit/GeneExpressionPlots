(()=>{(function(){"use strict";var sn=function(){return function(n){n=n||{};var n=typeof n!="undefined"?n:{},s,c;n.ready=new Promise(function(e,t){s=e,c=t});var i={},f;for(f in n)n.hasOwnProperty(f)&&(i[f]=n[f]);var l=!0,r="",b;typeof document!="undefined"&&document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="";var g=n.print||console.log.bind(console),y=n.printErr||console.warn.bind(console);for(f in i)i.hasOwnProperty(f)&&(n[f]=i[f]);i=null,n.arguments,n.thisProgram,n.quit;var m;n.wasmBinary&&(m=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&k("no native wasm support detected");var R,_=!1;function x(e,t){e||k("Assertion failed: "+t)}function S(e){var t=n["_"+e];return x(t,"Cannot call unknown function "+e+", make sure it is exported"),t}function L(e,t,a,h,w){var p={string:function(E){var P=0;if(E!=null&&E!==0){var an=(E.length<<2)+1;P=D(an),vn(E,P,an)}return P},array:function(E){var P=D(E.length);return gn(E,P),P}};function u(E){return t==="string"?J(E):t==="boolean"?Boolean(E):E}var o=S(e),v=[],I=0;if(h)for(var d=0;d<h.length;d++){var rn=p[a[d]];rn?(I===0&&(I=en()),v[d]=rn(h[d])):v[d]=h[d]}var B=o.apply(null,v);return B=u(B),I!==0&&tn(I),B}function pn(e,t,a,h){a=a||[];var w=a.every(function(u){return u==="number"}),p=t!=="string";return p&&w&&!h?S(e):function(){return L(e,t,a,arguments)}}var G=typeof TextDecoder!="undefined"?new TextDecoder("utf8"):void 0;function Y(e,t,a){for(var h=t+a,w=t;e[w]&&!(w>=h);)++w;if(w-t>16&&e.subarray&&G)return G.decode(e.subarray(t,w));for(var p="";t<w;){var u=e[t++];if(!(u&128)){p+=String.fromCharCode(u);continue}var o=e[t++]&63;if((u&224)==192){p+=String.fromCharCode((u&31)<<6|o);continue}var v=e[t++]&63;if((u&240)==224?u=(u&15)<<12|o<<6|v:u=(u&7)<<18|o<<12|v<<6|e[t++]&63,u<65536)p+=String.fromCharCode(u);else{var I=u-65536;p+=String.fromCharCode(55296|I>>10,56320|I&1023)}}return p}function J(e,t){return e?Y(C,e,t):""}function yn(e,t,a,h){if(!(h>0))return 0;for(var w=a,p=a+h-1,u=0;u<e.length;++u){var o=e.charCodeAt(u);if(o>=55296&&o<=57343){var v=e.charCodeAt(++u);o=65536+((o&1023)<<10)|v&1023}if(o<=127){if(a>=p)break;t[a++]=o}else if(o<=2047){if(a+1>=p)break;t[a++]=192|o>>6,t[a++]=128|o&63}else if(o<=65535){if(a+2>=p)break;t[a++]=224|o>>12,t[a++]=128|o>>6&63,t[a++]=128|o&63}else{if(a+3>=p)break;t[a++]=240|o>>18,t[a++]=128|o>>12&63,t[a++]=128|o>>6&63,t[a++]=128|o&63}}return t[a]=0,a-w}function vn(e,t,a){return yn(e,C,t,a)}typeof TextDecoder!="undefined"&&new TextDecoder("utf-16le");function gn(e,t){K.set(e,t)}var K,C,F;function hn(e){n.HEAP8=K=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=F=new Int32Array(e),n.HEAPU8=C=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}n.INITIAL_MEMORY;var $,Q=[],X=[],Z=[];function wn(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)En(n.preRun.shift());z(Q)}function bn(){z(X)}function Rn(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)_n(n.postRun.shift());z(Z)}function En(e){Q.unshift(e)}function Tn(e){X.unshift(e)}function _n(e){Z.unshift(e)}var A=0,O=null;function An(e){A++,n.monitorRunDependencies&&n.monitorRunDependencies(A)}function In(e){if(A--,n.monitorRunDependencies&&n.monitorRunDependencies(A),A==0&&O){var t=O;O=null,t()}}n.preloadedImages={},n.preloadedAudios={};function k(e){n.onAbort&&n.onAbort(e),e+="",y(e),_=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw c(t),t}var dn="data:application/octet-stream;base64,";function Sn(e){return e.startsWith(dn)}var T,T;T="/GeneExpressionPlots/gsl.wasm";function M(e){try{if(e==T&&m)return new Uint8Array(m);if(!b)throw"both async and sync fetching of the wasm failed"}catch(t){k(t)}}function Pn(){return!m&&l&&typeof fetch=="function"?fetch(T,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+T+"'";return e.arrayBuffer()}).catch(function(){return M(T)}):Promise.resolve().then(function(){return M(T)})}function xn(){var e={env:nn,wasi_snapshot_preview1:nn};function t(u,o){var v=u.exports;n.asm=v,R=n.asm.memory,hn(R.buffer),$=n.asm.__indirect_function_table,Tn(n.asm.__wasm_call_ctors),In()}An();function a(u){t(u.instance)}function h(u){return Pn().then(function(o){var v=WebAssembly.instantiate(o,e);return v}).then(u,function(o){y("failed to asynchronously prepare wasm: "+o),k(o)})}function w(){return!m&&typeof WebAssembly.instantiateStreaming=="function"&&!Sn(T)&&typeof fetch=="function"?fetch(T,{credentials:"same-origin"}).then(function(u){var o=WebAssembly.instantiateStreaming(u,e);return o.then(a,function(v){return y("wasm streaming compile failed: "+v),y("falling back to ArrayBuffer instantiation"),h(a)})}):h(a)}if(n.instantiateWasm)try{var p=n.instantiateWasm(e,t);return p}catch(u){return y("Module.instantiateWasm callback failed with error: "+u),!1}return w().catch(c),{}}function z(e){for(;e.length>0;){var t=e.shift();if(typeof t=="function"){t(n);continue}var a=t.func;typeof a=="number"?t.arg===void 0?$.get(a)():$.get(a)(t.arg):a(t.arg===void 0?null:t.arg)}}function Cn(){k()}function Fn(e,t,a){C.copyWithin(e,t,t+a)}var U={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var a=U.buffers[e];t===0||t===10?((e===1?g:y)(Y(a,0)),a.length=0):a.push(t)},varargs:void 0,get:function(){U.varargs+=4;var e=F[U.varargs-4>>2];return e},getStr:function(e){var t=J(e);return t},get64:function(e,t){return e}};function On(e){return 0}function kn(e,t,a,h,w){}function jn(e,t,a,h){for(var w=0,p=0;p<a;p++){for(var u=F[t+p*8>>2],o=F[t+(p*8+4)>>2],v=0;v<o;v++)U.printChar(e,C[u+v]);w+=o}return F[h>>2]=w,0}function Un(e){}var nn={abort:Cn,emscripten_memcpy_big:Fn,fd_close:On,fd_seek:kn,fd_write:jn,setTempRet0:Un};xn(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._gsl_ran_hypergeometric_pdf=function(){return(n._gsl_ran_hypergeometric_pdf=n.asm.gsl_ran_hypergeometric_pdf).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.__errno_location).apply(null,arguments)};var en=n.stackSave=function(){return(en=n.stackSave=n.asm.stackSave).apply(null,arguments)},tn=n.stackRestore=function(){return(tn=n.stackRestore=n.asm.stackRestore).apply(null,arguments)},D=n.stackAlloc=function(){return(D=n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)};n.dynCall_jiji=function(){return(n.dynCall_jiji=n.asm.dynCall_jiji).apply(null,arguments)},n.ccall=L,n.cwrap=pn;var V;O=function e(){V||N(),V||(O=e)};function N(e){if(A>0||(wn(),A>0))return;function t(){V||(V=!0,n.calledRun=!0,!_&&(bn(),s(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),Rn()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),t()},1)):t()}if(n.run=N,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return N(),n.ready}}();const cn=sn();function H(n,s,c,i,f){const l=[n+f,s-f,c-f,i+f];if(l.findIndex(r=>r<0)===-1)return l}function W(n,s,c,i){return cn.then(f=>f._gsl_ran_hypergeometric_pdf(n,n+s,c+i,n+c))}async function fn(n,s,c,i){const f=[n,s,c,i];if(f.findIndex(m=>m<0)!==-1)throw new Error("Negative numbers are not supported.");if(f.findIndex(m=>!Number.isInteger(m))!==-1)throw new Error("Only positive integers are supported.");let l=0,r=[n,s,c,i];do{const m=await W(r[0],r[1],r[2],r[3]);if(m===0)break;l+=m,r=H(r[0],r[1],r[2],r[3],-1)}while(r!==void 0);let b=0;r=[n,s,c,i];do{const m=await W(r[0],r[1],r[2],r[3]);if(m===0)break;b+=m,r=H(r[0],r[1],r[2],r[3],1)}while(r!==void 0);const g=Math.min(l,b),y=Math.min(g*2,1);return{leftPValue:l,rightPValue:b,oneTailedPValue:g,twoTailedPValue:y}}function j(n,s){if(n.constructor.name!=="Set"||s.constructor.name!=="Set")throw Error(`Arguments must be of class 'Set', but a is an ${n.constructor.name} and b is an ${s.constructor.name}`);const c=[...n];return new Set(c.filter(i=>s.has(i)))}function q(n,s,c,i,f){const l=[j(n,c).size,j(s,c).size,j(i,n).size,j(i,s).size];if(f){const r=[],b=l.reduce((x,S)=>x+S),g=new Set([...n,...s,...c,...i]).size;b!==g&&r.push(`Contingency table sums up to ${b}, but universe has (arguments union to a set of) ${g} elements. This number must be identical.`);const y=l[0]+l[2];y!==n.size&&r.push(`${n.size} elements have trait 'A', but contingency table's first column sums to ${y}. Numbers must be equal.`);const m=l[0]+l[1];m!==n.size&&r.push(`${n.size} elements have trait 'B', but contingency table's first row sums to ${m}. Numbers must be equal.`);const R=l[1]+l[3];R!==s.size&&r.push(`${s.size} elements have trait 'A', but contingency table's second column sums to ${R}. Numbers must be equal.`);const _=l[2]+l[3];if(_!==s.size&&r.push(`${s.size} elements have trait 'B', but contingency table's second row sums to ${_}. Numbers must be equal.`),r.length>0)throw Error(r.join(" "))}return l}function on(n,s){switch(n){case"<":return c=>Object.entries(c).filter(i=>parseFloat(i[1])<parseFloat(s)).map(i=>i[0]);case">":return c=>Object.entries(c).filter(i=>parseFloat(i[1])>parseFloat(s)).map(i=>i[0]);case"<=":return c=>Object.entries(c).filter(i=>parseFloat(i[1])<=parseFloat(s)).map(i=>i[0]);case">=":return c=>Object.entries(c).filter(i=>parseFloat(i[1])>=parseFloat(s)).map(i=>i[0]);case"==":return c=>Object.entries(c).filter(i=>i[1]==s).map(i=>i[0]);case"regexp":return c=>Object.entries(c).filter(i=>{const f=new RegExp(s);return!!i[1].match(f)}).map(i=>i[0]);default:throw new Error(`unsupported selector ${n}`)}}async function un(n){return await fn(n[0],n[1],n[2],n[3])}async function ln(n){const s=[],c=Object.keys(n).length;return await Promise.all(Object.entries(n).map(async([i,f])=>{const r=(await un(f)).rightPValue,b=r*c,g=b>1?1:b;s.push([i,r,g])})),s}function mn(n,s,c,i,f){switch(f.TEIselectorType){case"binary":{const l=on(f.TEIselector,f.TEIselectorValue),r=new Set(l(i)),b=new Set(n.filter(m=>!r.has(m))),g=`${f.TEIcolumn} ${f.TEIselector} ${f.TEIselectorValue}`,y=q(s,c,r,b);return{[g]:y}}case"multinomial":{const l={};let r=[];return Object.entries(i).forEach(([g,y])=>{var m;if(f.TEIselector==="delimiter")r=y.split(f.TEIselectorValue);else if(f.TEFselector==="regexp"){const R=new RegExp(f.TEIselectorValue,"g");r=(m=y.match(R))!=null?m:[]}r&&r.forEach(R=>{Array.isArray(l[R])?l[R].push(g):l[R]=[g]})}),Object.entries(l).reduce((g,[y,m])=>{if(m.some(R=>s.has(R))){const R=new Set(m),_=new Set(n.filter(S=>!R.has(S))),x=q(s,c,R,_);g[y]=x}return g},{})}default:throw new Error(`unsupported selector type ${f.TEIselectorType}`)}}onmessage=async function(n){const{geneIdsTEFpos:s,geneIdsTEFneg:c,TEIpayload:i,options:f}=n.data,l=[...s,...c],r=mn(l,s,c,i,f),b=await ln(r);postMessage(b.sort(),void 0)}})();})();
